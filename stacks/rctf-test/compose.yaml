version: "3.8"
services:
  rctf:
    image: ghcr.io/minpeter/rctf:main
    restart: unless-stopped
    env_file: [.env]
    volumes:
      - ./conf.d:/app/conf.d
    networks: [traefik, rctf]
    labels:
      - traefik.enable=true
      - traefik.http.routers.rctf.rule=Host(`rctf.minpeter.tech`)
    depends_on:
      - redis
      - postgres
  redis:
    image: redis:latest
    restart: always
    command: ["redis-server", "--requirepass", "1234"]
    networks: [rctf]
    volumes:
      - rctf-redis:/data
  postgres:
    image: postgres:latest
    restart: always
    environment:
      - POSTGRES_PASSWORD=1234
      - POSTGRES_USER=rctf
      - POSTGRES_DB=rctf
    networks: [rctf]
    volumes:
      - rctf-postgres:/var/lib/postgresql/data
networks:
  traefik:
    external: true
  rctf:

volumes:
  rctf-redis:
  rctf-postgres:
